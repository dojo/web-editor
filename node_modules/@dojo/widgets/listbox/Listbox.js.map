{"version":3,"file":"Listbox.js","sourceRoot":"","sources":["Listbox.ts"],"names":[],"mappings":"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","sourcesContent":["import { auto, reference } from '@dojo/widget-core/diff';\nimport { diffProperty } from '@dojo/widget-core/decorators/diffProperty';\nimport Dimensions from '@dojo/widget-core/meta/Dimensions';\nimport { DNode } from '@dojo/widget-core/interfaces';\nimport { Keys } from '../common/util';\nimport MetaBase from '@dojo/widget-core/meta/Base';\nimport { ThemedMixin, ThemedProperties, theme } from '@dojo/widget-core/mixins/Themed';\nimport uuid from '@dojo/core/uuid';\nimport { v, w } from '@dojo/widget-core/d';\nimport { WidgetBase } from '@dojo/widget-core/WidgetBase';\n\nimport * as css from './styles/listbox.m.css';\nimport ListboxOption from './ListboxOption';\n\n/* Default scroll meta */\nexport class ScrollMeta extends MetaBase {\n\tpublic scroll(key: string | number, amount: number): void {\n\t\tconst node = this.getNode(key);\n\t\tif (node) {\n\t\t\tnode.scrollTop = amount;\n\t\t}\n\t}\n}\n\n/**\n * @type ListboxProperties\n *\n * Properties that can be set on a Listbox component\n *\n * @property activeIndex          Index of the currently active listbox option\n * @property describedBy          ID of an element that provides more descriptive text\n * @property getOptionLabel       Function to return string label based on option data\n * @property getOptionDisabled    Function that accepts option data and returns a boolean for disabled/not disabled\n * @property getOptionId          Function that accepts option data and returns a string ID\n * @property getOptionSelected    Function that accepts option data and returns a boolean for selected/unselected\n * @property id                   Optional custom id for the listbox\n * @property multiselect          Adds currect semantics for a multiselect listbox\n * @property optionData           Array of data for listbox options\n * @property tabIndex             Listbox is in the focus order by default, but setting tabIndex: -1 will remove it\n * @property visualFocus          When controlling Listbox through an outside widget, e.g. in ComboBox, visualFocus mimics visual focus styling when true\n * @property onActiveIndexChange  Called with the index of the new requested active descendant\n * @property onOptionSelect       Called with the option data of the new requested selected item\n */\n\nexport interface ListboxProperties extends ThemedProperties {\n\tactiveIndex?: number;\n\tdescribedBy?: string;\n\tgetOptionDisabled?(option: any, index: number): boolean;\n\tgetOptionId?(option: any, index: number): string;\n\tgetOptionLabel?(option: any, index: number): DNode;\n\tgetOptionSelected?(option: any, index: number): boolean;\n\tid?: string;\n\tmultiselect?: boolean;\n\toptionData?: any[];\n\ttabIndex?: number;\n\tvisualFocus?: boolean;\n\tonActiveIndexChange?(index: number, key?: string | number): void;\n\tonKeyDown?(event: KeyboardEvent, key?: string | number): void;\n\tonOptionSelect?(option: any, index: number, key?: string | number): void;\n}\n\nexport const ThemedBase = ThemedMixin(WidgetBase);\n\n@theme(css)\n@diffProperty('optionData', reference)\nexport default class Listbox extends ThemedBase<ListboxProperties> {\n\tprivate _boundRenderOption = this.renderOption.bind(this);\n\tprivate _idBase = uuid();\n\n\tprivate _getOptionDisabled(option: any, index: number) {\n\t\tconst { getOptionDisabled } = this.properties;\n\t\treturn getOptionDisabled ? getOptionDisabled(option, index) : false;\n\t}\n\n\tprivate _getOptionId(index: number): string {\n\t\tconst { optionData = [], getOptionId } = this.properties;\n\t\treturn getOptionId ? getOptionId(optionData[index], index) : `${this._idBase}-${index}`;\n\t}\n\n\tprivate _onKeyDown(event: KeyboardEvent) {\n\t\tconst {\n\t\t\tactiveIndex = 0,\n\t\t\tkey,\n\t\t\toptionData = [],\n\t\t\tonActiveIndexChange,\n\t\t\tonOptionSelect,\n\t\t\tonKeyDown\n\t\t} = this.properties;\n\n\t\tonKeyDown && onKeyDown(event, key);\n\n\t\tconst activeItem = optionData[activeIndex];\n\t\tlet newIndex: number;\n\n\t\tswitch (event.which) {\n\t\t\tcase Keys.Enter:\n\t\t\tcase Keys.Space:\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif (!this._getOptionDisabled(activeItem, activeIndex)) {\n\t\t\t\t\tonOptionSelect && onOptionSelect(activeItem, activeIndex, key);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase Keys.Down:\n\t\t\t\tevent.preventDefault();\n\t\t\t\tnewIndex = (activeIndex + 1) % optionData.length;\n\t\t\t\tonActiveIndexChange && onActiveIndexChange(newIndex, key);\n\t\t\t\tbreak;\n\t\t\tcase Keys.Up:\n\t\t\t\tevent.preventDefault();\n\t\t\t\tnewIndex = (activeIndex - 1 + optionData.length) % optionData.length;\n\t\t\t\tonActiveIndexChange && onActiveIndexChange(newIndex, key);\n\t\t\t\tbreak;\n\t\t\tcase Keys.Home:\n\t\t\t\tonActiveIndexChange && onActiveIndexChange(0, key);\n\t\t\t\tbreak;\n\t\t\tcase Keys.End:\n\t\t\t\tonActiveIndexChange && onActiveIndexChange(optionData.length - 1, key);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate _onOptionClick(option: any, index: number, key?: string | number) {\n\t\tconst { onActiveIndexChange, onOptionSelect } = this.properties;\n\t\tif (!this._getOptionDisabled(option, index)) {\n\t\t\tonActiveIndexChange && onActiveIndexChange(index, key);\n\t\t\tonOptionSelect && onOptionSelect(option, index, key);\n\t\t}\n\t}\n\n\tprotected animateScroll(scrollValue: number) {\n\t\tthis.meta(ScrollMeta).scroll('root', scrollValue);\n\t}\n\n\t@diffProperty('activeIndex', auto)\n\tprotected calculateScroll(previousProperties: ListboxProperties, { activeIndex = 0 }: ListboxProperties) {\n\t\tconst menuDimensions = this.meta(Dimensions).get('root');\n\t\tconst scrollOffset = menuDimensions.scroll.top;\n\t\tconst menuHeight = menuDimensions.offset.height;\n\t\tconst optionOffset = this.meta(Dimensions).get(this._getOptionId(activeIndex)).offset;\n\n\t\tif (optionOffset.top - scrollOffset < 0) {\n\t\t\tthis.animateScroll(optionOffset.top);\n\t\t}\n\n\t\telse if ((optionOffset.top + optionOffset.height) > (scrollOffset + menuHeight)) {\n\t\t\tthis.animateScroll(optionOffset.top + optionOffset.height - menuHeight);\n\t\t}\n\t}\n\n\tprotected getModifierClasses() {\n\t\tconst { visualFocus } = this.properties;\n\t\treturn [\n\t\t\tvisualFocus ? css.focused : null\n\t\t];\n\t}\n\n\tprotected getOptionClasses(active: boolean, disabled: boolean, selected: boolean) {\n\t\treturn [\n\t\t\tcss.option,\n\t\t\tactive ? css.activeOption : null,\n\t\t\tdisabled ? css.disabledOption : null,\n\t\t\tselected ? css.selectedOption : null\n\t\t];\n\t}\n\n\tprotected renderOptionLabel(option: any, index: number): DNode {\n\t\tconst { getOptionLabel } = this.properties;\n\t\treturn getOptionLabel ? getOptionLabel(option, index) : `${option}`;\n\t}\n\n\tprotected renderOption(option: any, index: number): DNode {\n\t\tconst {\n\t\t\tactiveIndex = 0,\n\t\t\tgetOptionSelected,\n\t\t\ttheme\n\t\t} = this.properties;\n\n\t\tconst disabled = this._getOptionDisabled(option, index);\n\t\tconst selected = getOptionSelected ? getOptionSelected(option, index) : false;\n\n\t\treturn v('div', { key: this._getOptionId(index) }, [\n\t\t\tw(ListboxOption, {\n\t\t\t\tactive: activeIndex === index,\n\t\t\t\tclasses: this.getOptionClasses(activeIndex === index, disabled, selected),\n\t\t\t\tdisabled,\n\t\t\t\tlabel: this.renderOptionLabel(option, index),\n\t\t\t\tid: this._getOptionId(index),\n\t\t\t\tindex: index,\n\t\t\t\tkey: `option-${index}`,\n\t\t\t\toption,\n\t\t\t\tselected,\n\t\t\t\ttheme,\n\t\t\t\tonClick: this._onOptionClick\n\t\t\t})\n\t\t]);\n\t}\n\n\tprotected renderOptions(): DNode[] {\n\t\tconst {\n\t\t\toptionData = []\n\t\t} = this.properties;\n\n\t\treturn optionData.map(this._boundRenderOption);\n\t}\n\n\tprotected render(): DNode {\n\t\tconst {\n\t\t\tactiveIndex = 0,\n\t\t\tdescribedBy,\n\t\t\tid,\n\t\t\tmultiselect = false,\n\t\t\ttabIndex = 0\n\t\t} = this.properties;\n\n\t\treturn v('div', {\n\t\t\t'aria-activedescendant': this._getOptionId(activeIndex),\n\t\t\t'aria-multiselectable': multiselect ? 'true' : null,\n\t\t\tclasses: this.theme([ css.root, ...this.getModifierClasses() ]),\n\t\t\tdescribedBy,\n\t\t\tid,\n\t\t\tkey: 'root',\n\t\t\trole: 'listbox',\n\t\t\ttabIndex,\n\t\t\tonkeydown: this._onKeyDown\n\t\t}, this.renderOptions());\n\t}\n}\n"]}