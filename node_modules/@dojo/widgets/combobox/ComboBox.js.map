{"version":3,"file":"ComboBox.js","sourceRoot":"","sources":["ComboBox.ts"],"names":[],"mappings":"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","sourcesContent":["import { diffProperty } from '@dojo/widget-core/decorators/diffProperty';\nimport { DNode } from '@dojo/widget-core/interfaces';\nimport { Keys } from '../common/util';\nimport { reference } from '@dojo/widget-core/diff';\nimport { ThemedMixin, ThemedProperties, theme } from '@dojo/widget-core/mixins/Themed';\nimport { WidgetBase } from '@dojo/widget-core/WidgetBase';\nimport uuid from '@dojo/core/uuid';\nimport { v, w } from '@dojo/widget-core/d';\n\nimport Label, { LabelOptions } from '../label/Label';\nimport Listbox from '../listbox/Listbox';\nimport TextInput, { TextInputProperties } from '../textinput/TextInput';\n\nimport * as css from './styles/comboBox.m.css';\nimport * as iconCss from '../common/styles/icons.m.css';\n\n/**\n * @type ComboBoxProperties\n *\n * Properties that can be set on a ComboBox component\n *\n * @property clearable          Determines whether the input should be able to be cleared\n * @property disabled           Prevents user interaction and styles content accordingly\n * @property getResultLabel     Can be used to get the text label of a result based on the underlying result object\n * @property id                 Optional id string for the combobox\n * @property inputProperties    TextInput properties to set on the underlying input\n * @property invalid            Determines if this input is valid\n * @property isResultDisabled   Used to determine if an item should be disabled\n * @property label              Label to show for this input\n * @property onBlur             Called when the input is blurred\n * @property onChange           Called when the value changes\n * @property onFocus            Called when the input is focused\n * @property onMenuChange       Called when menu visibility changes\n * @property onRequestResults   Called when results are shown; should be used to set `results`\n * @property openOnFocus        Determines whether the result list should open when the input is focused\n * @property readOnly           Prevents user interaction\n * @property required           Determines if this input is required, styles accordingly\n * @property results            Results for the current search term; should be set in response to `onRequestResults`\n * @property value              Value to set on the input\n */\nexport interface ComboBoxProperties extends ThemedProperties {\n\tclearable?: boolean;\n\tdisabled?: boolean;\n\tgetResultLabel?(result: any): string;\n\tid?: string;\n\tinputProperties?: TextInputProperties;\n\tinvalid?: boolean;\n\tisResultDisabled?(result: any): boolean;\n\tlabel?: string | LabelOptions;\n\tonBlur?(value: string, key?: string | number): void;\n\tonChange?(value: string, key?: string | number): void;\n\tonFocus?(value: string, key?: string | number): void;\n\tonMenuChange?(open: boolean, key?: string | number): void;\n\tonRequestResults?(key?: string | number): void;\n\topenOnFocus?: boolean;\n\treadOnly?: boolean;\n\trequired?: boolean;\n\tresults?: any[];\n\tvalue?: string;\n}\n\n// Enum used when traversing items using arrow keys\nexport const enum Operation {\n\tincrease = 1,\n\tdecrease = -1\n}\n\nexport const ThemedBase = ThemedMixin(WidgetBase);\n\n@theme(css)\n@theme(iconCss)\n@diffProperty('results', reference)\nexport default class ComboBox extends ThemedBase<ComboBoxProperties> {\n\tprivate _activeIndex = 0;\n\tprivate _callInputFocus = false;\n\tprivate _ignoreBlur: boolean;\n\tprivate _idBase = uuid();\n\tprivate _menuHasVisualFocus = false;\n\tprivate _open: boolean;\n\tprivate _wasOpen: boolean;\n\n\tprivate _closeMenu() {\n\t\tthis._open = false;\n\t\tthis.invalidate();\n\t}\n\n\tprivate _getMenuId() {\n\t\treturn `${this._idBase}-menu`;\n\t}\n\n\tprivate _getResultLabel(result: any) {\n\t\tconst { getResultLabel } = this.properties;\n\n\t\treturn getResultLabel ? getResultLabel(result) : `${result}`;\n\t}\n\n\tprivate _getResultId(result: any, index: number) {\n\t\treturn `${this._idBase}-result${index}`;\n\t}\n\n\tprivate _onArrowClick() {\n\t\tconst {\n\t\t\tdisabled,\n\t\t\treadOnly\n\t\t} = this.properties;\n\n\t\tif (!disabled && !readOnly) {\n\t\t\tthis._callInputFocus = true;\n\t\t\tthis._openMenu();\n\t\t}\n\t}\n\n\tprivate _onClearClick() {\n\t\tconst { key, onChange } = this.properties;\n\n\t\tthis._callInputFocus = true;\n\t\tthis.invalidate();\n\t\tonChange && onChange('', key);\n\t}\n\n\tprivate _onInput(event: Event) {\n\t\tconst { key, onChange } = this.properties;\n\n\t\tonChange && onChange((<HTMLInputElement> event.target).value, key);\n\t\tthis._openMenu();\n\t}\n\n\tprivate _onInputBlur(event: FocusEvent) {\n\t\tconst { key, onBlur } = this.properties;\n\n\t\tif (this._ignoreBlur) {\n\t\t\tthis._ignoreBlur = false;\n\t\t\treturn;\n\t\t}\n\n\t\tonBlur && onBlur((<HTMLInputElement> event.target).value, key);\n\t\tthis._closeMenu();\n\t}\n\n\tprivate _onInputFocus(event: FocusEvent) {\n\t\tconst {\n\t\t\tkey,\n\t\t\tonFocus,\n\t\t\topenOnFocus\n\t\t} = this.properties;\n\n\t\tonFocus && onFocus((<HTMLInputElement> event.target).value, key);\n\t\topenOnFocus && this._openMenu();\n\t}\n\n\tprivate _onInputKeyDown(event: KeyboardEvent) {\n\t\tconst {\n\t\t\tdisabled,\n\t\t\tisResultDisabled = () => false,\n\t\t\treadOnly,\n\t\t\tresults = []\n\t\t} = this.properties;\n\t\tthis._menuHasVisualFocus = true;\n\n\t\tswitch (event.which) {\n\t\t\tcase Keys.Up:\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis._moveActiveIndex(Operation.decrease);\n\t\t\t\tbreak;\n\t\t\tcase Keys.Down:\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif (!this._open && !disabled && !readOnly) {\n\t\t\t\t\tthis._openMenu();\n\t\t\t\t}\n\t\t\t\telse if (this._open) {\n\t\t\t\t\tthis._moveActiveIndex(Operation.increase);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase Keys.Escape:\n\t\t\t\tthis._open && this._closeMenu();\n\t\t\t\tbreak;\n\t\t\tcase Keys.Enter:\n\t\t\tcase Keys.Space:\n\t\t\t\tif (this._open && results.length > 0) {\n\t\t\t\t\tif (isResultDisabled(results[this._activeIndex])) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis._selectIndex(this._activeIndex);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase Keys.Home:\n\t\t\t\tthis._activeIndex = 0;\n\t\t\t\tthis.invalidate();\n\t\t\t\tbreak;\n\t\t\tcase Keys.End:\n\t\t\t\tthis._activeIndex = results.length - 1;\n\t\t\t\tthis.invalidate();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate _onMenuChange() {\n\t\tconst { key, onMenuChange } = this.properties;\n\n\t\tif (!onMenuChange) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._open && !this._wasOpen && onMenuChange(true, key);\n\t\t!this._open && this._wasOpen && onMenuChange(false, key);\n\t}\n\n\tprivate _onResultHover(): void {\n\t\tthis._menuHasVisualFocus = false;\n\t\tthis.invalidate();\n\t}\n\n\tprivate _onResultMouseDown() {\n\t\t// Maintain underlying input focus on next render\n\t\tthis._ignoreBlur = true;\n\t}\n\n\tprivate _openMenu() {\n\t\tconst {\n\t\t\tkey,\n\t\t\tonRequestResults\n\t\t} = this.properties;\n\n\t\tthis._activeIndex = 0;\n\t\tthis._open = true;\n\t\tonRequestResults && onRequestResults(key);\n\t\tthis.invalidate();\n\t}\n\n\tprivate _selectIndex(index: number) {\n\t\tconst {\n\t\t\tkey,\n\t\t\tonChange,\n\t\t\tresults = []\n\t\t} = this.properties;\n\n\t\tthis._callInputFocus = true;\n\t\tthis._closeMenu();\n\t\tonChange && onChange(this._getResultLabel(results[index]), key);\n\t}\n\n\tprivate _moveActiveIndex(operation: Operation) {\n\t\tconst { results = [] } = this.properties;\n\n\t\tif (results.length === 0) {\n\t\t\tthis._activeIndex = 0;\n\t\t\tthis.invalidate();\n\t\t\treturn;\n\t\t}\n\n\t\tconst total = results.length;\n\t\tconst nextIndex = (this._activeIndex + operation + total) % total;\n\n\t\tthis._activeIndex = nextIndex;\n\t\tthis.invalidate();\n\t}\n\n\tprotected onElementUpdated(element: HTMLElement, key: string) {\n\t\tif (key === 'root') {\n\t\t\tif (this._callInputFocus) {\n\t\t\t\tthis._callInputFocus = false;\n\t\t\t\tconst input = element.querySelector('input') as HTMLElement;\n\t\t\t\tinput && input.focus();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected renderInput(): DNode {\n\t\tconst {\n\t\t\tclearable,\n\t\t\tdisabled,\n\t\t\tinputProperties = {},\n\t\t\tinvalid,\n\t\t\treadOnly,\n\t\t\trequired,\n\t\t\tresults = [],\n\t\t\tvalue = '',\n\t\t\ttheme\n\t\t} = this.properties;\n\n\t\treturn w(TextInput, <TextInputProperties> {\n\t\t\t...inputProperties,\n\t\t\tkey: 'textinput',\n\t\t\t'aria-activedescendant': this._getResultId(results[this._activeIndex], this._activeIndex),\n\t\t\t'aria-owns': this._getMenuId(),\n\t\t\tclasses: this.theme(clearable ? css.clearable : null),\n\t\t\tcontrols: this._getMenuId(),\n\t\t\tdisabled,\n\t\t\tinvalid,\n\t\t\tonBlur: this._onInputBlur,\n\t\t\tonFocus: this._onInputFocus,\n\t\t\tonInput: this._onInput,\n\t\t\tonKeyDown: this._onInputKeyDown,\n\t\t\treadOnly,\n\t\t\trequired,\n\t\t\ttheme,\n\t\t\tvalue\n\t\t});\n\t}\n\n\tprotected renderClearButton(): DNode {\n\t\tconst {\n\t\t\tdisabled,\n\t\t\treadOnly\n\t\t} = this.properties;\n\n\t\treturn v('button', {\n\t\t\t'aria-controls': this._getMenuId(),\n\t\t\tclasses: this.theme(css.clear),\n\t\t\tdisabled,\n\t\t\treadOnly,\n\t\t\tonclick: this._onClearClick\n\t\t}, [\n\t\t\t'clear combo box',\n\t\t\tv('i', { classes: this.theme([ iconCss.icon, iconCss.closeIcon ]),\n\t\t\t\trole: 'presentation', 'aria-hidden': 'true'\n\t\t\t})\n\t\t]);\n\t}\n\n\tprotected renderMenuButton(): DNode {\n\t\tconst {\n\t\t\tdisabled,\n\t\t\treadOnly\n\t\t} = this.properties;\n\n\t\treturn v('button', {\n\t\t\tclasses: this.theme(css.trigger),\n\t\t\tdisabled,\n\t\t\treadOnly,\n\t\t\ttabIndex: -1,\n\t\t\tonclick: this._onArrowClick\n\t\t}, [\n\t\t\t'open combo box',\n\t\t\tv('i', {\n\t\t\t\t'aria-hidden': 'true',\n\t\t\t\tclasses: this.theme([ iconCss.icon, iconCss.downIcon ]),\n\t\t\t\trole: 'presentation'\n\t\t\t})\n\t\t]);\n\t}\n\n\tprotected renderMenu(results: any[]): DNode {\n\t\tconst { theme, isResultDisabled } = this.properties;\n\n\t\tif (results.length === 0 || !this._open) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn v('div', {\n\t\t\tkey: 'dropdown',\n\t\t\tclasses: this.theme(css.dropdown),\n\t\t\tonmouseover: this._onResultHover,\n\t\t\tonmousedown: this._onResultMouseDown\n\t\t}, [\n\t\t\tw(Listbox, {\n\t\t\t\tactiveIndex: this._activeIndex,\n\t\t\t\tid: this._getMenuId(),\n\t\t\t\tvisualFocus: this._menuHasVisualFocus,\n\t\t\t\toptionData: results,\n\t\t\t\ttabIndex: -1,\n\t\t\t\tgetOptionDisabled: isResultDisabled,\n\t\t\t\tgetOptionId: this._getResultId,\n\t\t\t\tgetOptionLabel: this._getResultLabel,\n\t\t\t\tonActiveIndexChange: (index: number) => {\n\t\t\t\t\tthis._activeIndex = index;\n\t\t\t\t\tthis.invalidate();\n\t\t\t\t},\n\t\t\t\tonOptionSelect: (option: any, index: number) => {\n\t\t\t\t\tthis._selectIndex(index);\n\t\t\t\t},\n\t\t\t\ttheme\n\t\t\t})\n\t\t]);\n\t}\n\n\trender(): DNode {\n\t\tconst {\n\t\t\tclearable,\n\t\t\tid,\n\t\t\tinvalid,\n\t\t\tlabel,\n\t\t\treadOnly,\n\t\t\trequired,\n\t\t\tresults = [],\n\t\t\ttheme\n\t\t} = this.properties;\n\n\t\tconst menu = this.renderMenu(results);\n\t\tthis._onMenuChange();\n\t\tthis._wasOpen = this._open;\n\n\t\tlet controls: DNode = v('div', <any> {\n\t\t\tclasses: this.theme(css.controls)\n\t\t}, [\n\t\t\tthis.renderInput(),\n\t\t\tclearable ? this.renderClearButton() : null,\n\t\t\tthis.renderMenuButton()\n\t\t]);\n\n\t\tif (label) {\n\t\t\tcontrols = w(Label, {\n\t\t\t\tlabel,\n\t\t\t\ttheme\n\t\t\t}, [ controls ]);\n\t\t}\n\n\t\treturn v('div', {\n\t\t\t'aria-expanded': this._open ? 'true' : 'false',\n\t\t\t'aria-haspopup': 'true',\n\t\t\t'aria-readonly': readOnly ? 'true' : 'false',\n\t\t\t'aria-required': required ? 'true' : 'false',\n\t\t\tid,\n\t\t\tclasses: this.theme([\n\t\t\t\tcss.root,\n\t\t\t\tthis._open ? css.open : null,\n\t\t\t\tinvalid ? css.invalid : null,\n\t\t\t\tinvalid === false ? css.valid : null\n\t\t\t]),\n\t\t\tkey: 'root',\n\t\t\trole: 'combobox'\n\t\t}, [\n\t\t\tcontrols,\n\t\t\tmenu\n\t\t]);\n\t}\n}\n"]}