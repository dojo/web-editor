{"version":3,"file":"Runner.js","sourceRoot":"","sources":["../../src/widgets/Runner.ts"],"names":[],"mappings":"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","sourcesContent":["import * as base64 from '@dojo/core/base64';\nimport { v, w } from '@dojo/widget-core/d';\nimport { Constructor, DNode, VirtualDomProperties, WidgetProperties } from '@dojo/widget-core/interfaces';\nimport WidgetBase from '@dojo/widget-core/WidgetBase';\nimport afterRender from '@dojo/widget-core/decorators/afterRender';\nimport { ThemedMixin, ThemedProperties, theme } from '@dojo/widget-core/mixins/Themed';\nimport DomWrapper from '@dojo/widget-core/util/DomWrapper';\nimport { Program } from '../project';\nimport DOMParser from '../support/DOMParser';\nimport { wrapCode } from '../support/sourceMap';\n\nimport * as runnerCss from '../styles/runner.m.css';\n\nexport interface RunnerProperties extends Partial<Program>, ThemedProperties {\n\t/**\n\t * A URI that points to an AMD loader which will be used when running the program.\n\t * Defaults to `https://unpkg.com/@dojo/loader/loader.min.js`\n\t */\n\tloader?: string;\n\n\tmain?: string;\n\n\t/**\n\t * A URI that points to the `src` to set on the Runner's `iframe`. Defaults to `../support/blank.html`\n\t */\n\tsrc?: string;\n\n\t/**\n\t * A method that will be called whenever there is an error in the running program\n\t */\n\tonError?(err: Error): void;\n\n\t/**\n\t * A method that will be called when the `Runner` has fully loaded the program.  *Note* this does not\n\t * represent the state of the running program, it simply indicates that the `Runner` no longer has\n\t * involvement in the process of loading the program\n\t */\n\tonRun?(): void;\n}\n\n/**\n * The semver for the `tslib` package, which provides the TypeScript helper functions\n */\nconst TSLIB_SEMVER = '^1.8.0';\n\n/**\n * The default URI for the AMD loader to use when running a program\n */\nconst DEFAULT_LOADER_URI = 'https://unpkg.com/@dojo/loader/loader.min.js';\n\n/**\n * The default source that should be displayed in the IFrame before the runner loads a program\n */\nconst DEFAULT_IFRAME_SRC = '../support/blank.html';\n\n/**\n * A map of custom package data that needs to be added if this package is part of project that is being run\n */\nconst PACKAGE_DATA: { [pkg: string]: string } = {\n\tcldrjs: `{ name: 'cldr', location: 'https://unpkg.com/cldrjs@<%SEMVER>/dist/cldr', main: '../cldr' }`,\n\tglobalize: `{ name: 'globalize', main: '/dist/globalize' }`,\n\tmaquette: `{ name: 'maquette', main: '/dist/maquette.min' }`,\n\tpepjs: `{ name: 'pepjs', main: 'dist/pep' }`,\n\ttslib: `{ name: 'tslib', location: 'https://unpkg.com/tslib@${TSLIB_SEMVER}/', main: 'tslib' }`\n};\n\n/**\n * Generate an HTML document source\n * @param strings Array of template strings\n * @param css The CSS as an array of strings\n * @param html The HTML to be used in the body of the document\n * @param dependencies A map of package dependencies required\n * @param modules Any modules to be injected into the page\n * @return The generated HTML document\n */\nfunction docSrc(\n\tstrings: TemplateStringsArray,\n\tscripts: string[],\n\tcss: { name: string; text: string; }[],\n\tbodyAttributes: { [attr: string]: string; },\n\thtml: string,\n\tloaderSrc: string,\n\tdependencies: { [pkg: string]: string; },\n\tpackages: string[],\n\tmodules: { [mid: string]: { code: string, map: string } },\n\tmain: string\n): string {\n\tconst paths: string[] = [];\n\tfor (const pkg in dependencies) {\n\t\tpaths.push(`'${pkg}': 'https://unpkg.com/${pkg}@${dependencies[pkg]}'`);\n\t}\n\tconst pathsText = `{\\n\\t\\t\\t\\t\\t\\t\\t${paths.join(',\\n\\t\\t\\t\\t\\t\\t\\t')}\\n\\t\\t\\t\\t\\t\\t}`;\n\n\tconst packagesText = `[\n\t\t\t\t\t\t\t${packages.join(',\\n\\t\\t\\t\\t\\t\\t\\t')}\n\t\t\t\t\t\t]`;\n\n\tlet modulesText = '';\n\tfor (const mid in modules) {\n\t\t/* inject each source module as its own <script> block */\n\t\tconst filename = mid + '.js';\n\t\tmodulesText += '<script>';\n\t\tconst source = wrapCode(`cache['${mid}'] = function () {\\n`, modules[mid], '\\n};\\n');\n\t\tmodulesText += source.code;\n\t\t/* if we have a sourcemap then we encode it and add it to the page */\n\t\tif (modules[mid].map) {\n\t\t\tconst map = source.map.toJSON();\n\t\t\tmap.file = filename;\n\t\t\tmodulesText += `//# sourceMappingURL=data:application/json;base64,${base64.encode(JSON.stringify(map))}\\n`;\n\t\t}\n\t\t/* adding the sourceURL gives debuggers a \"name\" for this block of code */\n\t\tmodulesText += `//# sourceURL=${filename}\\n`;\n\t\tmodulesText += '</script>\\n';\n\t}\n\n\tconst cssText = css.map(({ name, text }) => {\n\t\t/* when external CSS is brought into a document, its URL URIs might not be encoded, this will encode them */\n\t\tconst encoded = text.replace(/url\\(['\"]?(.*?)[\"']?\\)/ig, (match, p1: string) => `url('${encodeURI(p1)}')`);\n\t\treturn `<style>\\n${encoded}\\n</style>`;\n\t}).join('\\n');\n\n\tlet scriptsText = '';\n\tscripts.forEach((src) => {\n\t\tscriptsText += `<script src=\"${src}\"></script>\\n\\t`;\n\t});\n\n\tlet bodyAttributesText = '';\n\tfor (const attr in bodyAttributes) {\n\t\tbodyAttributesText += ` ${attr}=\"${bodyAttributes[attr]}\"`;\n\t}\n\n\tconst mainText = `require([ '${main}' ], function () { });`;\n\n\tconst parts = [ scriptsText, cssText, bodyAttributesText, html, loaderSrc, pathsText, packagesText, modulesText, mainText ];\n\n\tconst text = parts\n\t\t.reduce((previous, text, index) => {\n\t\t\treturn previous + strings[index] + text + '\\n';\n\t\t}, '');\n\n\treturn text + strings.slice(parts.length).join('\\n');\n}\n\n/**\n * Return the information for packages based on dependencies for the project\n * @param dependencies The project dependencies\n */\nfunction getPackages(dependencies: { [pkg: string]: string; }): string[] {\n\tconst packages: string[] = [];\n\tObject.keys(PACKAGE_DATA).forEach((key) => {\n\t\tif (key in dependencies && key !== 'tslib') {\n\t\t\tpackages.push(PACKAGE_DATA[key].replace('<%SEMVER>', dependencies[key]));\n\t\t}\n\t});\n\tpackages.push(PACKAGE_DATA['tslib']); /* we are always going to inject this one */\n\treturn packages;\n}\n\n/**\n * Generate an HTML page which represents the Runner properties\n * @param param0 Properties from the Runner to be used to specify the document\n */\nfunction getSource({ css = [], dependencies = {}, loader = DEFAULT_LOADER_URI, main = 'src/main', html = '', modules = {} }: RunnerProperties): string {\n\tconst { attributes, body, css: text, scripts } = parseHtml(html);\n\tif (text) {\n\t\tcss.unshift({ name: 'project index', text });\n\t}\n\n\treturn docSrc`<!DOCTYPE html>\n\t\t\t<html>\n\t\t\t<head>\n\t\t\t\t${scripts}\n\t\t\t\t${css}\n\t\t\t</head>\n\t\t\t<body${attributes}>\n\t\t\t\t${body}\n\t\t\t\t<script src=\"${loader}\"></script>\n\t\t\t\t<script>require.config({\n\tpaths: ${dependencies},\n\tpackages: ${getPackages(dependencies)}\n});\n\nvar cache = {};\n//# sourceURL=web-editor/config.js\n\t\t\t\t</script>\n\t\t\t\t${modules}\n\t\t\t\t<script>require.cache(cache);\n\nrequire([ 'tslib', '@dojo/core/request', '../support/providers/amdRequire' ], function () {\n\tvar request = require('@dojo/core/request').default;\n\tvar getProvider = require('../support/providers/amdRequire').default;\n\trequest.setDefaultProvider(getProvider(require));\n\t${main}\n});\n//# sourceURL=web-editor/bootstrap.js\n\t\t\t\t</script>\n\t\t\t</body>\n\t\t\t</html>`;\n}\n\n/**\n * Determine if a string is a local or remote URI, returning `true` if remote, otherwise `false`\n * @param text string of text to check\n */\nfunction isRemoteURI(text: string): boolean {\n\tconst currenthost = `${window.location.protocol}//${window.location.hostname}`;\n\tif (text.indexOf(currenthost) >= 0) {\n\t\treturn false;\n\t}\n\treturn /^http(?:s)?:\\/{2}/.test(text);\n}\n\n/**\n * Extract some specific content from an HTML document and return it\n * @param content The source HTML content\n */\nfunction parseHtml(content: string): { attributes: { [attr: string]: string }, body: string, css: string, scripts: string[] } {\n\tconst parser = new DOMParser();\n\tconst doc = parser.parseFromString(content, 'text/html');\n\tconst scriptNodes = doc.querySelectorAll('script');\n\tconst scripts: string[] = [];\n\tfor (let i = 0; i < scriptNodes.length; i++) {\n\t\tconst script = scriptNodes[i];\n\t\tscript.parentElement && script.parentElement.removeChild(script);\n\t\tif (script.src && isRemoteURI(script.src)) {\n\t\t\tscripts.push(script.src);\n\t\t}\n\t}\n\tconst css: string[] = [];\n\tconst styles = doc.querySelectorAll('style');\n\tfor (let i = 0; i < styles.length; i++) {\n\t\tconst style = styles[i];\n\t\tif (style.textContent && style.getAttribute('scoped') === null) {\n\t\t\tcss.push(style.textContent);\n\t\t}\n\t}\n\tconst attributes: { [attr: string]: string } = {};\n\tfor (let i = 0; i < doc.body.attributes.length; i++) {\n\t\tattributes[doc.body.attributes[i].name] = doc.body.attributes[i].value;\n\t}\n\treturn {\n\t\tattributes, // not implmeneted yet\n\t\tbody: doc.body && doc.body.innerHTML || '',\n\t\tcss: css.join('\\n'),\n\t\tscripts\n\t};\n}\n\n/**\n * Write out the provided `source` to the target `iframe` and register an event listener for the `error` event on the `iframe`\n * @param iframe The `iframe` to have its document written to\n * @param source The document text to be written\n * @param errorListener The error listener that will be attached to the content window's error event\n */\nasync function writeIframeDoc(iframe: HTMLIFrameElement, source: string, errorListener: (evt: ErrorEvent) => void): Promise<void> {\n\treturn new Promise<void>((resolve, reject) => {\n\t\tfunction onLoadListener() {\n\t\t\tiframe.removeEventListener('load', onLoadListener);\n\t\t\tiframe.contentWindow.document.write(source);\n\t\t\tiframe.contentWindow.document.close();\n\t\t\tiframe.contentWindow.addEventListener('error', errorListener);\n\t\t\tresolve();\n\t\t}\n\n\t\tiframe.contentWindow.removeEventListener('error', errorListener);\n\t\tiframe.addEventListener('load', onLoadListener);\n\t\tiframe.contentWindow.location.reload();\n\t});\n}\n\nconst ThemedBase = ThemedMixin(WidgetBase);\n\n/**\n * A widget which will render its properties into a _runnable_ application within an `iframe`\n */\n@theme(runnerCss)\nexport default class Runner extends ThemedBase<RunnerProperties> {\n\tprivate _iframe: HTMLIFrameElement;\n\tprivate _IframeDom: Constructor<WidgetBase<VirtualDomProperties & WidgetProperties>>;\n\tprivate _onIframeError = (evt: ErrorEvent) => {\n\t\tevt.preventDefault();\n\t\tconst { onError } = this.properties;\n\t\tonError && onError(evt.error);\n\t}\n\tprivate _updating = false;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tconst iframe = this._iframe = document.createElement('iframe');\n\t\tiframe.setAttribute('src', DEFAULT_IFRAME_SRC);\n\t\tthis._IframeDom = DomWrapper(iframe);\n\t}\n\n\t@afterRender()\n\tprotected updateSource(node?: DNode): DNode | undefined {\n\t\tif (this._updating) {\n\t\t\treturn node;\n\t\t}\n\t\tif (this.properties.modules) {\n\t\t\tthis._updating = true;\n\t\t\tconst source = getSource(this.properties);\n\t\t\tthis._iframe.classList.add(runnerCss.running);\n\t\t\twriteIframeDoc(this._iframe, source, this._onIframeError)\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis._updating = false;\n\t\t\t\t\tconst { onRun } = this.properties;\n\t\t\t\t\tonRun && onRun();\n\t\t\t\t});\n\t\t}\n\t\treturn node;\n\t}\n\n\tprotected onDetach() {\n\t\tif (this._iframe.contentWindow) {\n\t\t\tthis._iframe.contentWindow.removeEventListener('error', this._onIframeError);\n\t\t}\n\t}\n\n\tprotected render() {\n\t\tconst { src = DEFAULT_IFRAME_SRC } = this.properties;\n\t\treturn v('div', {\n\t\t\tclasses: [ this.theme(runnerCss.root), runnerCss.rootFixed ]\n\t\t}, [ w(this._IframeDom, {\n\t\t\tclasses: [ this.theme(runnerCss.iframe), runnerCss.iframeFixed ],\n\t\t\tkey: 'runner',\n\t\t\tsrc,\n\t\t\ttitle: 'Runner'\n\t\t}) ]);\n\t}\n}\n"]}