{"version":3,"file":"Workbench.js","sourceRoot":"","sources":["../src/Workbench.ts"],"names":[],"mappings":"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","sourcesContent":["import { find, includes } from '@dojo/shim/array';\nimport { assign } from '@dojo/shim/object';\nimport { v, w } from '@dojo/widget-core/d';\nimport { WNode } from '@dojo/widget-core/interfaces';\nimport { ThemedMixin, ThemedProperties, theme } from '@dojo/widget-core/mixins/Themed';\nimport WidgetBase from '@dojo/widget-core/WidgetBase';\nimport Editor from './widgets/Editor';\nimport IconCss from './widgets/IconCss';\nimport { Program } from './project';\nimport Runner, { RunnerProperties } from './widgets/Runner';\nimport { Tab } from './widgets/Tablist';\nimport TreePane, { TreePaneItem } from './widgets/TreePane';\nimport Toolbar from './widgets/Toolbar';\nimport { IconJson, IconResolver } from './support/icons';\nimport * as iconCss from './styles/icons.m.css';\nimport * as workbenchCss from './styles/workbench.m.css';\n\nconst ThemedBase = ThemedMixin(WidgetBase);\n\nexport interface WorkbenchProperties extends ThemedProperties {\n\t/**\n\t * The filename that the editor should be displaying, otherwise `undefined`\n\t */\n\tfilename?: string;\n\n\t/**\n\t * An array of filenames that the workbench should be displaying in the file tree, otherwise `undefined`\n\t */\n\tfiles?: string[];\n\n\t/**\n\t * An object which expresses the icons that should be used when displaying file icons\n\t */\n\ticons?: IconJson;\n\n\t/**\n\t * The source path to the icons\n\t */\n\ticonsSourcePath?: string;\n\n\tmodel?: Editor['properties']['model'];\n\n\t/**\n\t * An array of filenames that have open tabs\n\t */\n\topenFiles?: string[];\n\n\t/**\n\t * Is the current program _runnable_ (meaning the UI should have an active run button)\n\t */\n\trunnable?: boolean;\n\n\t/**\n\t * The current emitted program that the runner should be running, otherwise `undefined`\n\t */\n\tprogram?: Program;\n\n\t/**\n\t * Called whenver a change is made to a file in the editor\n\t */\n\tonDirty?(): void;\n\n\t/**\n\t * Called when a file is attempting to close from the open tabs in the editor\n\t * @param filename The name of the file that is being request to be closed\n\t */\n\tonFileClose?(filename: string): void;\n\n\t/**\n\t * Called when a file is opened on the workbench\n\t * @param filename The name of the file that is being requested to be opened\n\t */\n\tonFileOpen?(filename: string): void;\n\n\t/**\n\t * Called when a file is attempted to be selected from the pen tabs in the editor\n\t * @param filename The name of the file that is being requested to be selected\n\t */\n\tonFileSelect?(filename: string): void;\n\n\t/**\n\t * Called when the runner completes loading the program\n\t */\n\tonRun?(): void;\n\n\t/**\n\t * Called when a run of the project is requested\n\t */\n\tonRunClick?(): void;\n}\n\n@theme(workbenchCss)\nexport default class Workbench extends ThemedBase<WorkbenchProperties> {\n\tprivate _expanded = [ './', './src' ];\n\tprivate _fileTreeOpen = true;\n\tprivate _iconResolver = new IconResolver();\n\tprivate _layoutEditor = false;\n\tprivate _runnerOpen = true;\n\tprivate _selected = '';\n\n\tprivate _getItemClass = (item: TreePaneItem, expanded?: boolean): string | undefined => {\n\t\tif (typeof item.label === 'string') {\n\t\t\treturn item.children && item.children.length ? this._iconResolver.folder(item.label, expanded) : this._iconResolver.file(item.label);\n\t\t}\n\t}\n\n\tprivate _getTabs(): WNode<Tab>[] {\n\t\tconst { properties: { filename: openFilename, openFiles, theme } } = this;\n\n\t\tif (!openFiles) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn openFiles.map((filename, idx) => {\n\t\t\tconst parts = filename.split(/[\\/\\\\]/);\n\t\t\t// TODO: deal with adding a labelDescription when duplicate files are opened\n\t\t\treturn w(Tab, {\n\t\t\t\ticonClass: this._iconResolver.file(filename),\n\t\t\t\tkey: `${idx}`,\n\t\t\t\tlabel: parts[parts.length - 1],\n\t\t\t\tselected: filename === openFilename,\n\t\t\t\ttitle: filename,\n\t\t\t\ttheme,\n\n\t\t\t\tonClose: this._onFileTabClose,\n\t\t\t\tonSelect: this._onFileTabSelect\n\t\t\t});\n\t\t});\n\t}\n\tprivate _getTreeRoot(): TreePaneItem | undefined {\n\t\t/**\n\t\t * Add a file to a tree of files, by parsing the filename and adding generating a `TreePaneItem`\n\t\t * @param root The root to add the file to\n\t\t * @param filename The full path of the filename\n\t\t */\n\t\tfunction addFile(root: TreePaneItem, filename: string): TreePaneItem {\n\t\t\tconst endsWithPathMarker = /[\\/\\\\]$/.test(filename);\n\t\t\tconst parts = filename.split(/[\\/\\\\]/);\n\t\t\tconst deliminator = filename.split('/').length === parts.length ? '/' : '\\\\';\n\t\t\tconst idParts: string[] = [];\n\t\t\tif (parts[0] === '.') {\n\t\t\t\tidParts.push(parts.shift()!);\n\t\t\t\tif (root.id === '') {\n\t\t\t\t\troot = {\n\t\t\t\t\t\tchildren: [],\n\t\t\t\t\t\tid: '.',\n\t\t\t\t\t\tlabel: '.',\n\t\t\t\t\t\ttitle: '.'\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet parent = root;\n\t\t\twhile (parts.length) {\n\t\t\t\tconst currentPart = parts[0];\n\t\t\t\tif (!parent.children) {\n\t\t\t\t\tparent.children = [];\n\t\t\t\t}\n\t\t\t\tlet item = find(parent.children, (child) => child.label === currentPart);\n\t\t\t\tif (!item) {\n\t\t\t\t\titem = {\n\t\t\t\t\t\tid: idParts.concat(currentPart).join(deliminator),\n\t\t\t\t\t\tlabel: currentPart,\n\t\t\t\t\t\ttitle: idParts.concat(currentPart).join(deliminator)\n\t\t\t\t\t};\n\t\t\t\t\tparent.children.push(item);\n\t\t\t\t}\n\t\t\t\tparent = item;\n\t\t\t\tidParts.push(parts.shift()!);\n\t\t\t}\n\t\t\tif (endsWithPathMarker && !parent.children) {\n\t\t\t\tparent.children = [];\n\t\t\t}\n\t\t\treturn root;\n\t\t}\n\n\t\tconst { files } = this.properties;\n\t\tif (files) {\n\t\t\treturn files\n\t\t\t\t.sort((a, b) => a < b ? -1 : 1)\n\t\t\t\t.reduce((previous, current) => addFile(previous, current), {\n\t\t\t\t\tid: '',\n\t\t\t\t\tlabel: '',\n\t\t\t\t\ttitle: ''\n\t\t\t\t} as TreePaneItem);\n\t\t}\n\t}\n\n\tprivate _onbeforeunload = (evt: BeforeUnloadEvent) => {\n\t\tif (this.properties.model) {\n\t\t\tevt.returnValue = 'Do you wish to navigate away from this page?';\n\t\t\treturn evt.returnValue;\n\t\t}\n\t}\n\n\tprivate _onItemOpen(id: string) {\n\t\tthis._selected = id;\n\t\tconst { onFileOpen } = this.properties;\n\t\tonFileOpen && onFileOpen(id);\n\t\tthis.invalidate();\n\t}\n\n\tprivate _onItemSelect(id: string) {\n\t\tthis._selected = id;\n\t\tthis.invalidate();\n\t}\n\n\tprivate _onItemToggle(id: string) {\n\t\tconst { _expanded } = this;\n\t\tif (includes(_expanded, id)) {\n\t\t\t_expanded.splice(_expanded.indexOf(id), 1);\n\t\t}\n\t\telse {\n\t\t\t_expanded.push(id);\n\t\t}\n\t\tthis.invalidate();\n\t}\n\n\tprivate _onFileTabClose = (key: string | number | undefined, label: string) => {\n\t\tconst { openFiles, onFileClose } = this.properties;\n\t\tconst idx = Number(key);\n\t\tif (onFileClose && openFiles && openFiles[idx]) {\n\t\t\tif (!this._fileTreeOpen && openFiles.length === 1) {\n\t\t\t\tthis._onToggleFiles();\n\t\t\t}\n\t\t\tonFileClose(openFiles[idx]);\n\t\t}\n\t}\n\n\tprivate _onFileTabSelect = (key: string | number | undefined, label: string) => {\n\t\tconst { openFiles, onFileSelect } = this.properties;\n\t\tconst idx = Number(key);\n\t\tif (onFileSelect && openFiles && openFiles[idx]) {\n\t\t\tonFileSelect(openFiles[idx]);\n\t\t}\n\t}\n\n\tprivate _onresize = () => {\n\t\tthis._layoutEditor = true;\n\t\tthis.invalidate();\n\t}\n\n\tprivate _onRun() {\n\t\tconst { onRun } = this.properties;\n\t\tif (!this._runnerOpen) {\n\t\t\tthis._onToggleRunner();\n\t\t}\n\t\tonRun && onRun();\n\t}\n\n\tprivate _onToggleFiles() {\n\t\tthis._fileTreeOpen = !this._fileTreeOpen;\n\t\tthis._layoutEditor = true;\n\t\tthis.invalidate();\n\t}\n\n\tprivate _onToggleRunner() {\n\t\tthis._runnerOpen = !this._runnerOpen;\n\t\tthis._layoutEditor = true;\n\t\tthis.invalidate();\n\t}\n\n\tprotected onAttach() {\n\t\twindow.addEventListener('resize', this._onresize);\n\t\twindow.addEventListener('beforeunload', this._onbeforeunload);\n\t}\n\n\tprotected onDetach() {\n\t\twindow.removeEventListener('resize', this._onresize);\n\t\twindow.removeEventListener('beforeunload', this._onbeforeunload);\n\t}\n\n\tprotected render() {\n\t\tconst {\n\t\t\t_expanded,\n\t\t\t_fileTreeOpen: filesOpen,\n\t\t\t_getItemClass: getItemClass,\n\t\t\t_layoutEditor: layout,\n\t\t\t_runnerOpen: runnerOpen,\n\t\t\t_selected: selected,\n\t\t\tproperties: {\n\t\t\t\ticons,\n\t\t\t\ticonsSourcePath: sourcePath,\n\t\t\t\tmodel,\n\t\t\t\tprogram,\n\t\t\t\trunnable,\n\t\t\t\ttheme,\n\t\t\t\tonDirty,\n\t\t\t\tonRunClick\n\t\t\t}\n\t\t} = this;\n\n\t\tif (icons && sourcePath) {\n\t\t\tthis._iconResolver.setProperties({ icons, sourcePath });\n\t\t}\n\n\t\t// Need to mixin the program into the Runner's properties\n\t\tconst runnerProperties: RunnerProperties = assign({}, program, { key: 'runner', theme, onRun: this._onRun });\n\n\t\t// if we are laying out the editor on this render, we can reset the state\n\t\tif (layout) {\n\t\t\tthis._layoutEditor = false;\n\t\t}\n\n\t\treturn v('div', {\n\t\t\tclasses: [ this.theme(workbenchCss.root), workbenchCss.rootFixed ]\n\t\t}, [\n\t\t\tw(IconCss, {\n\t\t\t\tbaseClass: iconCss.label,\n\t\t\t\ticons,\n\t\t\t\tkey: 'icons',\n\t\t\t\tsourcePath\n\t\t\t}),\n\t\t\tv('div', {\n\t\t\t\tclasses: this.theme([ workbenchCss.left, filesOpen ? null : workbenchCss.closed ]),\n\t\t\t\tkey: 'left'\n\t\t\t}, [\n\t\t\t\tw(TreePane, {\n\t\t\t\t\texpanded: [ ..._expanded ],\n\t\t\t\t\tgetItemClass,\n\t\t\t\t\tkey: 'treepane',\n\t\t\t\t\troot: this._getTreeRoot(),\n\t\t\t\t\tselected,\n\t\t\t\t\ttheme,\n\n\t\t\t\t\tonItemOpen: this._onItemOpen,\n\t\t\t\t\tonItemSelect: this._onItemSelect,\n\t\t\t\t\tonItemToggle: this._onItemToggle\n\t\t\t\t})\n\t\t\t]),\n\t\t\tv('div', {\n\t\t\t\tclasses: this.theme(workbenchCss.middle),\n\t\t\t\tkey: 'middle'\n\t\t\t}, [\n\t\t\t\tw(Toolbar, {\n\t\t\t\t\trunnable,\n\t\t\t\t\trunnerOpen,\n\t\t\t\t\tfilesOpen,\n\t\t\t\t\ttheme,\n\t\t\t\t\tonRunClick,\n\t\t\t\t\tonToggleFiles: this._onToggleFiles,\n\t\t\t\t\tonToggleRunner: this._onToggleRunner\n\t\t\t\t}, this._getTabs()),\n\t\t\t\tw(Editor, {\n\t\t\t\t\tkey: 'editor',\n\t\t\t\t\tlayout,\n\t\t\t\t\tmodel,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tfolding: true,\n\t\t\t\t\t\tminimap: { enabled: false },\n\t\t\t\t\t\trenderWhitespace: 'boundary'\n\t\t\t\t\t},\n\t\t\t\t\ttheme,\n\t\t\t\t\tonDirty\n\t\t\t\t})\n\t\t\t]),\n\t\t\tv('div', {\n\t\t\t\tclasses: this.theme([ workbenchCss.right, runnerOpen ? null : workbenchCss.closed ]),\n\t\t\t\tkey: 'right'\n\t\t\t}, [\n\t\t\t\tw(Runner, runnerProperties)\n\t\t\t])\n\t\t]);\n\t}\n}\n"]}